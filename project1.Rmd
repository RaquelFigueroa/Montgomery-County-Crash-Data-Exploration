---
title: 'Project 1: Montgomery County Crash Data'
author: "Regie & Raquel"
date: "3/30/2018"
output: html_document
---


```{r global_options, include=FALSE}
knitr::opts_chunk$set(prompt=TRUE, comment="", echo=TRUE)
dat = read.csv("https://raw.githubusercontent.com/RaquelFigueroa/Montgomery-County-Crash-Data-Exploration/master/Crash_Reporting_-_Drivers_Data.csv")

```

## Project Introduction

=> explain what you will do in a sentence or two <=


## Project Data

=> Explain in a few sentence where the data comes from, what it is about, etc. <=


## Initial data exploration

It should be noted that running the datdat function on the data showed that all but one row had complete data. When investigating that row in the data table, there was no evidence of missing data, except for where an empty string was entered into a cell. It was decided that that particular could contain important information for some visualizations, so all rows were kept.







## Data cleaning and preprocessing

=> Add stuff here <=


## Data exploration and visualization

This data exploration began with learning the times during which most accidents occur. 
By creating a bar graph of the number of accidents per hour of the day, it would be easier
to group times of accidents in a more fair manner. The following barplot shows which hours
have the highest numbers of accidents and which have the least. 

We can now see the hours during which the highest amount of accidents occur and the hours
during which the least number of accidents take place. The hours with the highest numbers of
accidents corresponds to the rush hours attributed to commutes to and from work.

```{r, echo=TRUE}
# Determine rush hour times
# get Crash.Date.Time in easy-to-use form:
date.time = strptime(as.character(dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")

# get just the hours from our usable dat.time:
hours = date.time$hour + 1

#create barplot of crashes per hour to determine hours of highest number of crashes
barplot(table(hours), main = "Number of Crashes per Hour of the Day", col = "firebrick")
```

It can be observed that the rush hour times are from 8:00 am - 10:00 am and from 4:00 pm - 7:00 pm.
This has led to following time groupings:


Time Group | Hours Interval
------------------- | ---------------
Rush Hour           | 8:00 am - 10:00 am, 4:00 pm - 7:00 pm
School Hours        | 11:00 am - 3:00 pm
Night Hours         | 8:00 pm - 10:00 pm
Late Night Hours    | 11:00 pm - 3:00 am
Early Morning Hours | 4:00 am - 7:00 am




Diving deeper into groupings of accidents by time, the time groups were used to determine accident locations throughout Montgomery County. By doing this, we can find accident locations that seem interesting and may warrant further investigation. A particular location of interest was determined to be in the Downtown Silver Spring area. This location had high number of accidents throughout all times of the day, indicating that it may be an area that local civil engineering departments may need to investigate for hazardous conditions.

The following scatter plots demonstrate accident locations using their longitudes and latitudes. The accident locations follow the Montgomery County highways and street systems, creating a map of the county that can be compared to an actual map which can help in identifying locations.

Below each scatter plot of the accidents in the greater Montgomery County, there is a corresponding scatter plot that is zoomed in on the Downtown Silver Spring area for a more detailed view of accident locations and their times.

####Accidents during Rush Hour

```{r, echo=TRUE}
#Create DF with Longitude, Latitude, hour of accident, collision type.
#This DF will be used for many plots
accident.times = data.frame(Longitude=dat$Longitude, Latitude=dat$Latitude, hour=strptime(as.character(dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, dat$Collision.Type)

# Create DF with accident.time as whole hour, longitude, latitude, collision type only for rush-hour times:
rush.hours = c(8, 9, 10, 16, 17, 18, 19)
accident.hours = accident.times[is.element(accident.times$hour ,rush.hours),]

# create a color vector:
colors = c("chocolate","darkorchid", "goldenrod4", "red3", "darkslateblue","firebrick1","firebrick4")
names(colors) = c(8, 9, 10, 16, 17, 18, 19)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.times$hour)], main = "Montgomery County Accident Locations: Rush Hour", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = rush.hours,col=colors[as.character(rush.hours)],pch=19, cex=0.7)


 
plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.0, -77.05), ylim = c(38.975, 39.025), pch = 20, col=colors[as.character(accident.times$hour)], main = "Downtown Silver Spring Accident Locations: Rush Hour", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = rush.hours,col=colors[as.character(rush.hours)],pch=19, cex=0.7)

```

####Accidents during School Hours

```{r, echo=TRUE}
# View map of accidents during school hours

# Create DF with accident.time as whole hour, longitude, latitude, collision type only for school-hour times:
school.hours = c(11, 12, 13, 14, 15)
accident.hours = accident.times[is.element(accident.times$hour ,school.hours),]

# create a color vector:
colors = c("blue", "deepskyblue", "purple", "springgreen","orchid3")
names(colors) = c(11, 12, 13, 14, 15)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.hours$hour)], main = "Montgomery County Accident Locations: School Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = school.hours,col=colors[as.character(school.hours)],pch=19, cex=0.7)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.0, -77.05), ylim = c(38.975, 39.025), pch = 20, col=colors[as.character(accident.hours$hour)], main = "Downtown Silver Spring Accident Locations: School Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = school.hours,col=colors[as.character(school.hours)],pch=19, cex=0.7)
```

####Accidents during Night Hours

```{r, echo=TRUE}
# Create DF with accident.time as whole hour, longitude, latitude, collision type only for latenight-hour times:
night.hours = c(20, 21, 22)
accident.hours = accident.times[is.element(accident.times$hour ,night.hours),]

# create a color vector:
colors = c("mediumturquoise","mediumvioletred", "midnightblue")
names(colors) = c(20, 21, 22)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.hours$hour)], main="Montgomery County Accident Locations: Night Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = night.hours,col=colors[as.character(night.hours)],pch=19, cex=0.7)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.0, -77.05), ylim = c(38.975, 39.025), pch = 20, col=colors[as.character(accident.hours$hour)], main="Downtown Silver Spring Accident Locations: Night Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = night.hours,col=colors[as.character(night.hours)],pch=19, cex=0.7)
```

####Accidents during Late Night Hours

```{r, echo=TRUE}
# Create DF with accident.time as whole hour, longitude, latitude, collision type only for latenight-hour times:
latenight.hours = c(1, 2, 3, 23, 24)
accident.hours = accident.times[is.element(accident.times$hour ,latenight.hours),]

# create a color vector:
colors = c("blue","purple", "springgreen", "orangered", "yellow2")
names(colors) = c(1, 2, 3, 23, 24)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.hours$hour)], main="Montgomery County Accident Locations: Late Night Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = latenight.hours,col=colors[as.character(latenight.hours)],pch=19, cex=0.7)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.0, -77.05), ylim = c(38.975, 39.025), pch = 20, col=colors[as.character(accident.hours$hour)], main="Downtown Silver Spring Accident Locations: late Night Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = latenight.hours,col=colors[as.character(latenight.hours)],pch=19, cex=0.7)
```


####Accidents during Early Morning Hours

```{r, echo=TRUE}
# Create DF with accident.time as whole hour, longitude, latitude, collision type only for rush-hour times:
morning.hours = c(4, 5, 6, 7)
accident.hours = accident.times[is.element(accident.times$hour ,morning.hours),]

# create a color vector:
colors = c("blue","purple", "springgreen", "orangered")
names(colors) = c(4, 5, 6, 7)

plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.hours$hour)], main="Montgomery County Accident Locations: Early Morning Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = morning.hours,col=colors[as.character(morning.hours)],pch=19, cex=0.7)

#close-up:
plot(accident.hours$Longitude, accident.hours$Latitude, xlim = c(-77.0, -77.05), ylim = c(38.975, 39.025), pch = 20, col=colors[as.character(accident.hours$hour)], main="Downtown Silver Spring Accident Locations: Early Morning Hours", ylab = "Latitude", xlab = "Longitude")
legend('topright',legend = morning.hours,col=colors[as.character(morning.hours)],pch=19, cex=0.7)
```







```{r}
accident.times = data.frame(Longitude=dat$Longitude, Latitude=dat$Latitude, hour=strptime(as.character(dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, dat$Collision.Type)
#1: ratio of colision types per hour
#table showing num accidents depend on hour/collision type
hr.table=table(accident.times$hour, accident.times$dat.Collision.Type)

# clean data of UNKNOWN, OTHER, N/A values:
cols = c("ANGLE MEETS LEFT HEAD ON","ANGLE MEETS LEFT TURN", "ANGLE MEETS RIGHT TURN","HEAD ON","HEAD ON LEFT TURN","OPPOSITE DIR BOTH LEFT TURN","OPPOSITE DIRECTION SIDESWIPE",                       
          "SAME DIR BOTH LEFT TURN","SAME DIR REAR END", "SAME DIR REND LEFT TURN","SAME DIR REND RIGHT TURN","SAME DIRECTION LEFT TURN","SAME DIRECTION RIGHT TURN",   
          "SAME DIRECTION SIDESWIPE","SINGLE VEHICLE","STRAIGHT MOVEMENT ANGLE")
plot(hr.table[,cols], las=1, col=rainbow(16), main = "Ratios of Collisions per Hour of the Day")
legend('topleft',legend = cols,col=rainbow(16),pch=19, cex=0.6, pt.cex = 1, y.intersp = 1.5)
```

```{r}
# what weather conditions were present during these time --> can include the Surface.Condition (see correlation)
# color the different locations (latitude & longitude) for every wesather type
# use lat and lon and weather
# this looks at the accidents that happened using long and lat
plot(Latitude ~ Longitude, data=dat, ylim = c(38.95, 39.33), xlim = c(-77.5,-76.9), pch=".", col="grey")
len = length(sort(table(dat$Weather), decreasing = TRUE))
vec = rainbow(len)
names = names(sort(table(dat$Weather), decreasing = TRUE))
for(i in 1:len){
  points(Latitude ~ Longitude, data=dat[dat$Weather==names[i],], col=vec[i], pch=".")
}
legend('topleft', title="Weather Conditions",legend = names, col=vec, pch=19, cex=0.6, pt.cex = 1, y.intersp = 1.5)
```


```{r}
# we are creating a visual map of where the accidents happened and what was the ACRS Report type
plot(Latitude ~ Longitude, data=dat, ylim = c(38.95, 39.33), xlim = c(-77.5,-76.9), pch=".", col="grey")
len = length(sort(table(dat$ACRS.Report.Type), decreasing = TRUE))
color = rainbow(len)
names = names(sort(table(dat$ACRS.Report.Type), decreasing = TRUE))
for(i in 1:len){
    points(Latitude ~ Longitude, data=dat[dat$ACRS.Report.Type==names[i],], col=color[i], pch=".") 
}
points(Latitude ~ Longitude, data=dat[dat$ACRS.Report.Type=="Fatal Crash",], col=color[i], pch="x") 
legend('topleft', title="Report Type",legend = names, col=color, pch=19, cex=0.6, pt.cex = 1, y.intersp = 1.5)
```

```{r}
# we are looking at weather the accidents are couased by more local residents living in Maryland, or different USA places or other countries
name = names(table(dat$Drivers.License.State))
maryland = "MD"
others = c("AB", "AS", "BC", "IT", "MB", "MH", "NL", "NS", "NT", "ON", "PR", "QC", "SK", "UM", "US", "VI", "XX", "YT")
states = as.vector(setdiff(setdiff(setdiff(name, others),maryland),""))
barplot(c(sum(dat$Drivers.License.State %in% maryland), sum(dat$Drivers.License.State %in% states), 
          sum(dat$Drivers.License.State %in% others)), names.arg =c("Local", "USA", "Others") )
```

## Conclusions

=> One paragraph about what you learned, issues you faced, etc. <=