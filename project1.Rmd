---
title: 'Project 1: Montgomery County Crash Data'
author: "Regie & Raquel"
date: "3/27/2018"
output: html_document
---


```{r global_options, include=FALSE}
knitr::opts_chunk$set(prompt=TRUE, comment="", echo=TRUE)
dat = read.csv("https://raw.githubusercontent.com/RaquelFigueroa/Montgomery-County-Crash-Data-Exploration/master/Crash_Reporting_-_Drivers_Data.csv")

```

## Project Introduction

=> explain what you will do in a sentence or two <=

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
summary(cars)
```

## Project Data

=> Explain in a few sentence where the data comes from, what it is about, etc. <=


## Initial data exploration

Determining rush hour times for more appropriate data analysis:
```{r}
# Determine rush hour times
# only use rows without missing data:
complete.dat = dat[complete.cases(dat),]

# get Crash.Date.Time in easy-to-use form:
date.time = strptime(as.character(complete.dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")

# get just the hours from our usable dat.time:
hours = date.time$hour + 1

# Create a table of hours and number of crashes per hour of day
table(hours)

#create barplot of crashes per hour to determine hours of highest number of crashes
barplot(table(hours), main = "Number of Crashes per Hour of the Day", col = "firebrick")
```

It can be observed that the rush hour times are from 8:00 am - 10:00 am and from 4:00 pm - 7:00 pm.

## Data cleaning and preprocessing

=> Add stuff here <=


## Data exploration and visualization

=> Add stuff here <=

Accidents during Rush Hours

```{r rush.hour, echo=FALSE}
# View map of accidents during rush hour

# only use rows without missing data:
complete.dat = dat[complete.cases(dat),]

# Create DF with accident.time as whole hour, longitude, latitude, collision type only for rush-hour times:
rush.hours = c(8, 9, 10, 16, 17, 18, 19)
accident.times = data.frame(Longitude=complete.dat$Longitude, Latitude=complete.dat$Latitude, hour=strptime(as.character(complete.dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, complete.dat$Collision.Type)
accident.times = accident.times[is.element(accident.times$hour ,rush.hours),]

# create a color vector:
colors = c("chocolate","darkorchid", "goldenrod4", "red3", "darkslateblue","firebrick1","firebrick4")
names(colors) = c(8, 9, 10, 16, 17, 18, 19)

plot(accident.times$Longitude, accident.times$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.times$hour)])
legend('topright',legend = rush.hours,col=colors[as.character(rush.hours)],pch=19, cex=0.7)
```

Accidents during School Hours

```{r school.hour, echo=FALSE}
# View map of accidents during school hours

# only use rows without missing data:
complete.dat = dat[complete.cases(dat),]

# Create DF with accident.time as whole hour, longitude, latitude, collision type only for school-hour times:
school.hours = c(11, 12, 13, 14, 15)

accident.times = data.frame(Longitude=complete.dat$Longitude, Latitude=complete.dat$Latitude, hour=strptime(as.character(complete.dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, complete.dat$Collision.Type)
accident.times = accident.times[is.element(accident.times$hour ,school.hours),]

# create a color vector:
colors = c("blue", "deepskyblue", "purple", "springgreen","orchid3")
names(colors) = c(11, 12, 13, 14, 15)

plot(accident.times$Longitude, accident.times$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.times$hour)])
legend('topright',legend = school.hours,col=colors[as.character(school.hours)],pch=19, cex=0.7)
```

```{r morning.hour, echo=FALSE}
# View map of accidents during morning hours

# only use rows without missing data:
complete.dat = dat[complete.cases(dat),]

# Create DF with accident.time as whole hour, longitude, latitude, collision type only for rush-hour times:
morning.hours = c(4, 5, 6, 7)

accident.times = data.frame(Longitude=complete.dat$Longitude, Latitude=complete.dat$Latitude, hour=strptime(as.character(complete.dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, complete.dat$Collision.Type)
accident.times = accident.times[is.element(accident.times$hour ,morning.hours),]

# create a color vector:
colors = c("blue","purple", "springgreen", "orangered")
names(colors) = c(4, 5, 6, 7)

plot(accident.times$Longitude, accident.times$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.times$hour)])
legend('topright',legend = morning.hours,col=colors[as.character(morning.hours)],pch=19, cex=0.7)
```

```{r latenight.hour, echo=FALSE}
# View map of accidents during late night hours

# only use rows without missing data:
complete.dat = dat[complete.cases(dat),]

# Create DF with accident.time as whole hour, longitude, latitude, collision type only for latenight-hour times:
latenight.hours = c(1, 2, 3, 23, 24)
accident.times = data.frame(Longitude=complete.dat$Longitude, Latitude=complete.dat$Latitude, hour=strptime(as.character(complete.dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, complete.dat$Collision.Type)
accident.times = accident.times[is.element(accident.times$hour ,latenight.hours),]

# create a color vector:
colors = c("blue","purple", "springgreen", "orangered", "yellow2")
names(colors) = c(1, 2, 3, 23, 24)

plot(accident.times$Longitude, accident.times$Latitude, xlim = c(-77.3, -76.92), ylim = c(38.94, 39.2), pch = ".", col=colors[as.character(accident.times$hour)])
legend('topright',legend = latenight.hours,col=colors[as.character(latenight.hours)],pch=19, cex=0.7)
```




```{r}
accident.times = data.frame(Longitude=dat$Longitude, Latitude=dat$Latitude, hour=strptime(as.character(dat$Crash.Date.Time), "%m/%d/%Y %I:%M:%S %p", tz = "America/New_York")$hour + 1, dat$Collision.Type)
#1: ratio of colision types per hour
#table showing num accidents depend on hour/collision type
hr.table=table(accident.times$hour, accident.times$dat.Collision.Type)

# clean data of UNKNOWN, OTHER, N/A values:
cols = c("ANGLE MEETS LEFT HEAD ON","ANGLE MEETS LEFT TURN", "ANGLE MEETS RIGHT TURN","HEAD ON","HEAD ON LEFT TURN","OPPOSITE DIR BOTH LEFT TURN","OPPOSITE DIRECTION SIDESWIPE",                       
          "SAME DIR BOTH LEFT TURN","SAME DIR REAR END", "SAME DIR REND LEFT TURN","SAME DIR REND RIGHT TURN","SAME DIRECTION LEFT TURN","SAME DIRECTION RIGHT TURN",   
          "SAME DIRECTION SIDESWIPE","SINGLE VEHICLE","STRAIGHT MOVEMENT ANGLE")
plot(hr.table[,cols], las=1, col=rainbow(16), main = "Ratios of Collisions per Hour of the Day")
legend('topleft',legend = cols,col=rainbow(16),pch=19, cex=0.6, pt.cex = 1, y.intersp = 1.5)
```

```{r}
# what weather conditions were present during these time --> can include the Surface.Condition (see correlation)
# color the different locations (latitude & longitude) for every wesather type
# use lat and lon and weather
# this looks at the accidents that happened using long and lat
plot(Latitude ~ Longitude, data=dat, ylim = c(38.95, 39.33), xlim = c(-77.5,-76.9), pch=".", col="grey")
len = length(sort(table(dat$Weather), decreasing = TRUE))
vec = rainbow(len)
names = names(sort(table(dat$Weather), decreasing = TRUE))
for(i in 1:len){
  points(Latitude ~ Longitude, data=dat[dat$Weather==names[i],], col=vec[i], pch=".")
}
legend('topleft', title="Weather Conditions",legend = names, col=vec, pch=19, cex=0.6, pt.cex = 1, y.intersp = 1.5)
```


```{r}
# we are creating a visual map of where the accidents happened and what was the ACRS Report type
plot(Latitude ~ Longitude, data=dat, ylim = c(38.95, 39.33), xlim = c(-77.5,-76.9), pch=".", col="grey")
len = length(sort(table(dat$ACRS.Report.Type), decreasing = TRUE))
color = rainbow(len)
names = names(sort(table(dat$ACRS.Report.Type), decreasing = TRUE))
for(i in 1:len){
    points(Latitude ~ Longitude, data=dat[dat$ACRS.Report.Type==names[i],], col=color[i], pch=".") 
}
points(Latitude ~ Longitude, data=dat[dat$ACRS.Report.Type=="Fatal Crash",], col=color[i], pch="x") 
legend('topleft', title="Report Type",legend = names, col=color, pch=19, cex=0.6, pt.cex = 1, y.intersp = 1.5)
```

```{r}
# we are looking at weather the accidents are couased by more local residents living in Maryland, or different USA places or other countries
name = names(table(dat$Drivers.License.State))
maryland = "MD"
others = c("AB", "AS", "BC", "IT", "MB", "MH", "NL", "NS", "NT", "ON", "PR", "QC", "SK", "UM", "US", "VI", "XX", "YT")
states = as.vector(setdiff(setdiff(setdiff(name, others),maryland),""))
barplot(c(sum(dat$Drivers.License.State %in% maryland), sum(dat$Drivers.License.State %in% states), 
          sum(dat$Drivers.License.State %in% others)), names.arg =c("Local", "USA", "Others") )
```

```{r}
par(mfrow=c(3,2)) 
fatal = names(table(dat$ACRS.Report.Type))
for(i in 1:length(table(dat$ACRS.Report.Type))){
  par(mar=c(3,9,3,3))
  tb = table(dat[dat$ACRS.Report.Type==fatal[i] & dat$Driver.At.Fault=="Yes",]$Weather)
  barplot(tb,horiz = T,las=2, cex.names = 0.5, main=paste(fatal[i], "w/ Driver At Fault"))
  par(mar=c(3,9,3,3))
  tb = table(dat[dat$ACRS.Report.Type==fatal[i] & dat$Driver.At.Fault=="No",]$Weather)
  barplot(tb,horiz = T,las=2, cex.names = 0.5, main=paste(fatal[i], "w/ Driver Not At Fault"))
}
```

## Conclusions

=> One paragraph about what you learned, issues you faced, etc. <=